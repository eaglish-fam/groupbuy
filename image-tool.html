<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ–ç‰‡å£“ç¸® + æµ®æ°´å°å·¥å…· - é·¹å®¶Funç”Ÿè²·ç‰©ç¤¾</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ–¼ï¸</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-pink-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white/80 backdrop-blur-sm border-b-2 border-amber-200 sticky top-0 z-10 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-amber-900">ğŸ–¼ï¸ åœ–ç‰‡å£“ç¸® + æµ®æ°´å°</h1>
          <p class="text-sm text-amber-700">é·¹å®¶Funç”Ÿè²·ç‰©ç¤¾ - å„ªåŒ–åœ–ç‰‡ï¼Œä¿è­·ç‰ˆæ¬Š</p>
        </div>
        <a href="/" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
          è¿”å›é¦–é 
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- èªªæ˜å¡ç‰‡ -->
    <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6">
      <h2 class="text-lg font-bold text-blue-900 mb-2">ğŸ“š å·¥å…·åŠŸèƒ½</h2>
      <div class="grid md:grid-cols-2 gap-4 text-sm text-blue-800">
        <div>
          <p class="font-semibold mb-1">ğŸ—œï¸ åœ–ç‰‡å£“ç¸®</p>
          <p class="text-xs">æ¸›å°‘æª”æ¡ˆå¤§å°ï¼ŒåŠ å¿«ç¶²é è¼‰å…¥é€Ÿåº¦</p>
        </div>
        <div>
          <p class="font-semibold mb-1">ğŸ’§ æµ®æ°´å°</p>
          <p class="text-xs">è‡ªå‹•åŠ ä¸Šå“ç‰Œæµ®æ°´å°ï¼Œé˜²æ­¢ç›œåœ–</p>
        </div>
      </div>
    </div>

    <!-- ä¸Šå‚³å€åŸŸ -->
    <div class="bg-white rounded-xl shadow-lg border-2 border-amber-200 overflow-hidden">
      <div class="bg-gradient-to-r from-amber-600 to-pink-600 p-4">
        <h2 class="text-xl font-bold text-white">ä¸Šå‚³åœ–ç‰‡</h2>
      </div>

      <div class="p-6">
        <!-- æ‹–æ‹½ä¸Šå‚³å€ -->
        <div 
          id="dropZone"
          class="border-4 border-dashed border-gray-300 rounded-xl p-12 text-center hover:border-amber-400 transition-colors cursor-pointer bg-gray-50"
          onclick="document.getElementById('fileInput').click()"
        >
          <div class="text-6xl mb-4">ğŸ“¤</div>
          <p class="text-lg font-bold text-gray-700 mb-2">æ‹–æ›³åœ–ç‰‡åˆ°é€™è£¡æˆ–é»æ“Šä¸Šå‚³</p>
          <p class="text-sm text-gray-500">æ”¯æ´ JPGã€PNGã€WebP æ ¼å¼</p>
          <input 
            type="file" 
            id="fileInput" 
            accept="image/*" 
            class="hidden" 
            onchange="handleFileSelect(event)"
            multiple
          >
        </div>

        <!-- è¨­å®šé¸é … -->
        <div id="optionsPanel" class="mt-6 space-y-5 hidden">
          <!-- å£“ç¸®å“è³ª -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label class="text-sm font-bold text-gray-700">å£“ç¸®å“è³ª</label>
              <span id="qualityValue" class="text-sm font-bold text-amber-600">80%</span>
            </div>
            <input 
              type="range" 
              id="qualitySlider" 
              min="10" 
              max="100" 
              value="80" 
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              oninput="updateQuality(this.value)"
            >
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>è¼ƒå°æª”æ¡ˆ</span>
              <span>è¼ƒé«˜å“è³ª</span>
            </div>
          </div>

          <!-- æœ€å¤§å¯¬åº¦ -->
          <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">æœ€å¤§å¯¬åº¦ï¼ˆåƒç´ ï¼‰</label>
            <select 
              id="maxWidth" 
              class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-amber-400 focus:outline-none"
            >
              <option value="0">ä¿æŒåŸå°ºå¯¸</option>
              <option value="800">800pxï¼ˆé©åˆç¶²é ï¼‰</option>
              <option value="1200" selected>1200pxï¼ˆæ¨è–¦ï¼‰</option>
              <option value="1920">1920pxï¼ˆé«˜è§£æåº¦ï¼‰</option>
              <option value="2400">2400pxï¼ˆè¶…é«˜è§£æåº¦ï¼‰</option>
            </select>
          </div>

          <!-- æµ®æ°´å°é¸é … -->
          <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-4">
            <div class="flex items-center gap-2 mb-3">
              <input 
                type="checkbox" 
                id="addWatermark" 
                class="w-5 h-5 text-purple-600 rounded"
                checked
              >
              <label for="addWatermark" class="text-sm font-bold text-purple-900">åŠ å…¥æµ®æ°´å°</label>
            </div>
            
            <div id="watermarkOptions" class="space-y-3">
              <div>
                <label class="block text-xs font-bold text-purple-700 mb-1">æµ®æ°´å°æ–‡å­—</label>
                <input 
                  type="text" 
                  id="watermarkText" 
                  value="é·¹å®¶Funç”Ÿè²·ç‰©ç¤¾"
                  class="w-full px-3 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none text-sm"
                >
              </div>
              
              <div>
                <label class="block text-xs font-bold text-purple-700 mb-1">ä½ç½®</label>
                <select 
                  id="watermarkPosition" 
                  class="w-full px-3 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none text-sm"
                >
                  <option value="bottom-right">å³ä¸‹è§’</option>
                  <option value="bottom-left">å·¦ä¸‹è§’</option>
                  <option value="top-right">å³ä¸Šè§’</option>
                  <option value="top-left">å·¦ä¸Šè§’</option>
                  <option value="center">ä¸­å¤®</option>
                </select>
              </div>
              
              <div>
                <label class="block text-xs font-bold text-purple-700 mb-1">é€æ˜åº¦</label>
                <input 
                  type="range" 
                  id="watermarkOpacity" 
                  min="10" 
                  max="100" 
                  value="50" 
                  class="w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer"
                >
                <div class="flex justify-between text-xs text-purple-600 mt-1">
                  <span>æ·¡</span>
                  <span id="opacityValue">50%</span>
                  <span>æ¿ƒ</span>
                </div>
              </div>
            </div>
          </div>

          <!-- è™•ç†æŒ‰éˆ• -->
          <button 
            onclick="processImages()" 
            class="w-full bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white py-4 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl">
            âœ¨ é–‹å§‹è™•ç†åœ–ç‰‡
          </button>
        </div>
      </div>
    </div>

    <!-- é è¦½å€åŸŸ -->
    <div id="previewSection" class="mt-6 hidden">
      <div class="bg-white rounded-xl shadow-lg border-2 border-green-200 overflow-hidden">
        <div class="bg-gradient-to-r from-green-600 to-teal-600 p-4">
          <h2 class="text-xl font-bold text-white">âœ¨ è™•ç†çµæœ</h2>
        </div>
        
        <div id="resultsContainer" class="p-6 space-y-6">
          <!-- è™•ç†å¾Œçš„åœ–ç‰‡æœƒå‹•æ…‹åŠ å…¥é€™è£¡ -->
        </div>
      </div>
    </div>

    <!-- ä½¿ç”¨æé†’ -->
    <div class="mt-6 bg-amber-50 rounded-xl border-2 border-amber-200 p-6">
      <h3 class="text-lg font-bold text-amber-900 mb-3">ğŸ’¡ ä½¿ç”¨å»ºè­°</h3>
      <ul class="text-sm text-amber-800 space-y-2">
        <li>âœ… <strong>å£“ç¸®å“è³ª</strong>ï¼š80% æ˜¯å“è³ªèˆ‡æª”æ¡ˆå¤§å°çš„æœ€ä½³å¹³è¡¡</li>
        <li>âœ… <strong>ç¶²é ç”¨åœ–</strong>ï¼šå»ºè­°æœ€å¤§å¯¬åº¦ 1200pxï¼Œæª”æ¡ˆå°è¼‰å…¥å¿«</li>
        <li>âœ… <strong>æµ®æ°´å°</strong>ï¼šé€æ˜åº¦ 40-60% æ—¢èƒ½ä¿è­·ç‰ˆæ¬Šåˆä¸å½±éŸ¿è§€çœ‹</li>
        <li>âœ… <strong>æ‰¹æ¬¡è™•ç†</strong>ï¼šå¯ä»¥ä¸€æ¬¡ä¸Šå‚³å¤šå¼µåœ–ç‰‡åŒæ™‚è™•ç†</li>
        <li>âœ… <strong>åŸåœ–ä¿ç•™</strong>ï¼šè™•ç†å¾Œçš„åœ–ç‰‡ä¸æœƒè¦†è“‹åŸåœ–ï¼Œè«‹æ”¾å¿ƒä½¿ç”¨</li>
      </ul>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white/80 border-t-2 border-amber-200 mt-12 py-6">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p class="text-sm text-amber-700">Â© 2025 é·¹å®¶Funç”Ÿè²·ç‰©ç¤¾ | åœ–ç‰‡å£“ç¸®å·¥å…·</p>
      <p class="text-xs text-amber-600 mt-1">Eaglish Family - ç²¾é¸åœ˜è³¼ï¼å„ªè³ªå¥½ç‰©</p>
    </div>
  </footer>

  <!-- Loading Toast -->
  <div id="loadingToast" class="fixed top-20 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50 hidden">
    <div class="flex items-center gap-2">
      <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
      <span>è™•ç†ä¸­...</span>
    </div>
  </div>

  <script>
    let uploadedFiles = [];

    // æ›´æ–°å“è³ªé¡¯ç¤º
    function updateQuality(value) {
      document.getElementById('qualityValue').textContent = value + '%';
    }

    // æ›´æ–°é€æ˜åº¦é¡¯ç¤º
    document.getElementById('watermarkOpacity').addEventListener('input', function() {
      document.getElementById('opacityValue').textContent = this.value + '%';
    });

    // æµ®æ°´å°é–‹é—œ
    document.getElementById('addWatermark').addEventListener('change', function() {
      document.getElementById('watermarkOptions').style.display = this.checked ? 'block' : 'none';
    });

    // æ‹–æ‹½ä¸Šå‚³
    const dropZone = document.getElementById('dropZone');

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('border-amber-400', 'bg-amber-50');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('border-amber-400', 'bg-amber-50');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('border-amber-400', 'bg-amber-50');
      
      const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
      if (files.length > 0) {
        handleFiles(files);
      }
    });

    // æª”æ¡ˆé¸æ“‡
    function handleFileSelect(event) {
      const files = Array.from(event.target.files);
      handleFiles(files);
    }

    function handleFiles(files) {
      uploadedFiles = files;
      document.getElementById('optionsPanel').classList.remove('hidden');
      
      // é¡¯ç¤ºæª”æ¡ˆè³‡è¨Š
      const info = files.length === 1 
        ? `å·²é¸æ“‡ 1 å¼µåœ–ç‰‡` 
        : `å·²é¸æ“‡ ${files.length} å¼µåœ–ç‰‡`;
      
      dropZone.innerHTML = `
        <div class="text-6xl mb-4">âœ“</div>
        <p class="text-lg font-bold text-green-600 mb-2">${info}</p>
        <p class="text-sm text-gray-500">é»æ“Šå¯é‡æ–°é¸æ“‡</p>
      `;
    }

    // è™•ç†åœ–ç‰‡
    async function processImages() {
      if (uploadedFiles.length === 0) {
        alert('è«‹å…ˆä¸Šå‚³åœ–ç‰‡ï¼');
        return;
      }

      // é¡¯ç¤ºè¼‰å…¥æç¤º
      const loadingToast = document.getElementById('loadingToast');
      loadingToast.classList.remove('hidden');
      loadingToast.style.opacity = '1';

      // å–å¾—è¨­å®š
      const quality = parseInt(document.getElementById('qualitySlider').value) / 100;
      const maxWidth = parseInt(document.getElementById('maxWidth').value);
      const addWatermark = document.getElementById('addWatermark').checked;
      const watermarkText = document.getElementById('watermarkText').value;
      const watermarkPosition = document.getElementById('watermarkPosition').value;
      const watermarkOpacity = parseInt(document.getElementById('watermarkOpacity').value) / 100;

      // æ¸…ç©ºçµæœå®¹å™¨
      const resultsContainer = document.getElementById('resultsContainer');
      resultsContainer.innerHTML = '';

      // è™•ç†æ¯å¼µåœ–ç‰‡
      for (let i = 0; i < uploadedFiles.length; i++) {
        const file = uploadedFiles[i];
        const result = await processImage(file, {
          quality,
          maxWidth,
          addWatermark,
          watermarkText,
          watermarkPosition,
          watermarkOpacity
        });

        // é¡¯ç¤ºçµæœ
        resultsContainer.innerHTML += createResultCard(file, result, i);
      }

      // éš±è—è¼‰å…¥æç¤º
      loadingToast.style.opacity = '0';
      setTimeout(() => loadingToast.classList.add('hidden'), 300);

      // é¡¯ç¤ºçµæœå€åŸŸ
      document.getElementById('previewSection').classList.remove('hidden');
      
      // æ»¾å‹•åˆ°çµæœ
      setTimeout(() => {
        document.getElementById('previewSection').scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      }, 100);
    }

    // è™•ç†å–®å¼µåœ–ç‰‡
    function processImage(file, options) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const img = new Image();
          
          img.onload = function() {
            // è¨ˆç®—æ–°å°ºå¯¸
            let width = img.width;
            let height = img.height;
            
            if (options.maxWidth > 0 && width > options.maxWidth) {
              height = (height * options.maxWidth) / width;
              width = options.maxWidth;
            }

            // å»ºç«‹ canvas
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            // ç¹ªè£½åœ–ç‰‡
            ctx.drawImage(img, 0, 0, width, height);

            // åŠ å…¥æµ®æ°´å°
            if (options.addWatermark && options.watermarkText) {
              addWatermarkToCanvas(ctx, width, height, options);
            }

            // è½‰æ›ç‚º blob
            canvas.toBlob((blob) => {
              const url = URL.createObjectURL(blob);
              
              resolve({
                url,
                blob,
                originalSize: file.size,
                newSize: blob.size,
                width,
                height
              });
            }, file.type, options.quality);
          };

          img.src = e.target.result;
        };

        reader.readAsDataURL(file);
      });
    }

    // åœ¨ canvas ä¸ŠåŠ æµ®æ°´å°
    function addWatermarkToCanvas(ctx, width, height, options) {
      ctx.save();
      
      // è¨­å®šæ–‡å­—æ¨£å¼
      const fontSize = Math.max(width * 0.04, 20);
      ctx.font = `bold ${fontSize}px Arial`;
      ctx.fillStyle = `rgba(255, 255, 255, ${options.watermarkOpacity})`;
      ctx.strokeStyle = `rgba(0, 0, 0, ${options.watermarkOpacity * 0.5})`;
      ctx.lineWidth = 2;

      // è¨ˆç®—æ–‡å­—å°ºå¯¸
      const textMetrics = ctx.measureText(options.watermarkText);
      const textWidth = textMetrics.width;
      const textHeight = fontSize;

      // è¨ˆç®—ä½ç½®
      let x, y;
      const padding = 20;

      switch (options.watermarkPosition) {
        case 'bottom-right':
          x = width - textWidth - padding;
          y = height - padding;
          break;
        case 'bottom-left':
          x = padding;
          y = height - padding;
          break;
        case 'top-right':
          x = width - textWidth - padding;
          y = textHeight + padding;
          break;
        case 'top-left':
          x = padding;
          y = textHeight + padding;
          break;
        case 'center':
          x = (width - textWidth) / 2;
          y = height / 2;
          break;
      }

      // ç¹ªè£½æ–‡å­—ï¼ˆå¸¶é™°å½±ï¼‰
      ctx.strokeText(options.watermarkText, x, y);
      ctx.fillText(options.watermarkText, x, y);
      
      ctx.restore();
    }

    // å»ºç«‹çµæœå¡ç‰‡
    function createResultCard(originalFile, result, index) {
      const compressionRate = ((1 - result.newSize / result.originalSize) * 100).toFixed(1);
      const originalSizeKB = (result.originalSize / 1024).toFixed(1);
      const newSizeKB = (result.newSize / 1024).toFixed(1);

      return `
        <div class="border-2 border-gray-200 rounded-lg overflow-hidden">
          <div class="grid md:grid-cols-2 gap-6 p-6">
            <!-- é è¦½åœ– -->
            <div>
              <p class="text-sm font-bold text-gray-700 mb-2">è™•ç†å¾Œé è¦½</p>
              <img src="${result.url}" alt="è™•ç†å¾Œ" class="w-full rounded-lg border-2 border-gray-300">
            </div>
            
            <!-- è³‡è¨Š -->
            <div>
              <p class="text-sm font-bold text-gray-700 mb-3">è™•ç†è³‡è¨Š</p>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">æª”æ¡ˆåç¨±ï¼š</span>
                  <span class="font-medium text-gray-900">${originalFile.name}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">åŸå§‹å¤§å°ï¼š</span>
                  <span class="font-medium text-gray-900">${originalSizeKB} KB</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">å£“ç¸®å¾Œï¼š</span>
                  <span class="font-medium text-green-600">${newSizeKB} KB</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">ç¯€çœç©ºé–“ï¼š</span>
                  <span class="font-bold text-green-600">${compressionRate}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">å°ºå¯¸ï¼š</span>
                  <span class="font-medium text-gray-900">${result.width} x ${result.height} px</span>
                </div>
              </div>
              
              <!-- ä¸‹è¼‰æŒ‰éˆ• -->
              <button 
                onclick="downloadImage(${index}, '${originalFile.name}')"
                class="w-full mt-6 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white py-3 rounded-lg font-bold transition-all shadow-md hover:shadow-lg">
                ğŸ“¥ ä¸‹è¼‰åœ–ç‰‡
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // ä¸‹è¼‰åœ–ç‰‡
    function downloadImage(index, originalName) {
      const resultsContainer = document.getElementById('resultsContainer');
      const img = resultsContainer.querySelectorAll('img')[index];
      
      const link = document.createElement('a');
      const fileName = originalName.replace(/\.[^/.]+$/, '') + '_processed.jpg';
      link.download = fileName;
      link.href = img.src;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
