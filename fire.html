<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>鷹家財務自由路徑試算｜FIRE Playground（離線 v1.3）</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#111827;--ink:#e5e7eb;--muted:#9ca3af;--line:#1f2937;
      --blue:#60a5fa;--orange:#fb923c;--green:#34d399;--asset:#cbd5e1;
      --sur:#8b5cf6;--life:#a78bfa;--fire:#ef4444;--fat:#f59e0b;--teal:#22d3ee;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;line-height:1.5}
    header{padding:16px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#0f172acc;backdrop-filter:blur(6px)}
    header h1{margin:0 0 4px 0;font-size:18px}
    header p{margin:0;color:var(--muted);font-size:12px}
    .wrap{display:grid;grid-template-columns:1fr;gap:12px;padding:12px;max-width:1200px;margin:0 auto}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .panel h2{margin:0;padding:10px 12px;border-bottom:1px solid var(--line);font-size:14px;color:#cbd5e1;letter-spacing:0.4px}
    .grid{display:grid;grid-template-columns:1fr;gap:8px;padding:10px}
    .row{display:grid;grid-template-columns:1.2fr 1fr;gap:8px;align-items:center}
    label{font-size:12px;color:var(--muted)}
    input[type="number"]{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #2b3443;background:#0b1220;color:var(--ink);outline:none}
    select{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #2b3443;background:#0b1220;color:var(--ink)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;padding:0 10px 10px}
    button{cursor:pointer;border:1px solid var(--line);background:#0b1220;color:#e5e7eb;padding:8px 12px;border-radius:10px}
    button.primary{background:#0ea5e9;border-color:#0284c7}
    .kpi{display:grid;grid-template-columns:1fr;gap:8px;padding:10px}
    .k{border:1px dashed #334155;border-radius:10px;padding:10px}
    .k h3{margin:0 0 8px 0;font-size:13px}
    .k p{margin:2px 0;font-size:12px;color:#cbd5e1}
    .ok{border-color:#14532d;background:rgba(34,197,94,0.08)}
    .warn{border-color:#7f1d1d;background:rgba(239,68,68,0.06)}
    .note{padding:8px 12px;color:#fbbf24;font-size:12px}
    canvas{display:block;width:100%;height:420px}
    @media(min-width:880px){
      .wrap{grid-template-columns:360px 1fr}
      .kpi{grid-template-columns:repeat(3,1fr)}
    }
  </style>
</head>
<body>
  <header>
    <h1>鷹家財務自由路徑試算｜FIRE Playground（離線 v1.3）</h1>
    <p>修正：<b>工作自由＝副業 ≥ 主業</b>。圖上新增「副業收入」曲線，並保留 FIRE 的「資產門檻」於右軸。</p>
  </header>

  <main class="wrap">
    <section class="panel">
      <h2>輸入參數（NT$/月；年化%）</h2>
      <div class="grid">
        <div class="row"><label>生存支出</label><input id="survival" type="number" step="1000" value="60000"/></div>
        <div class="row"><label>生活支出</label><input id="lifestyle" type="number" step="1000" value="120000"/></div>
        <div class="row"><label>FAT FIRE 支出</label><input id="fat" type="number" step="1000" value="216000"/></div>
        <div class="row"><label>目前資產淨值</label><input id="assets" type="number" step="10000" value="3000000"/></div>
        <div class="row"><label>主業收入（月）</label><input id="mainIncome" type="number" step="1000" value="200000"/></div>
        <div class="row"><label>副業收入（月）</label><input id="sideIncome" type="number" step="1000" value="40000"/></div>
        <div class="row"><label>主業年成長率 %</label><input id="mainGrowth" type="number" step="0.1" value="3"/></div>
        <div class="row"><label>副業年成長率 %</label><input id="sideGrowth" type="number" step="0.1" value="10"/></div>
        <div class="row"><label>投資年化報酬 %</label><input id="returnRate" type="number" step="0.1" value="6"/></div>
        <div class="row"><label>提領率 % / 年</label><input id="wr" type="number" step="0.1" value="4"/></div>
        <div class="row"><label>模擬年數</label><input id="years" type="number" min="1" max="60" value="40"/></div>
        <div class="row"><label>盈餘全部投入？</label>
          <select id="reinvest"><option value="yes" selected>是</option><option value="no">否</option></select>
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="calc">重新計算</button>
        <button id="fatfill">用生活 × 1.8 填入 FAT</button>
        <button id="reset">重設</button>
      </div>
      <div class="note">
        里程碑定義：生存自由（副業≥生存）／生活自由（總收入≥生活）／<b>工作自由（副業≥主業）</b>／FIRE（資產×提領率≥生活）／FAT FIRE。
      </div>
    </section>

    <section class="panel">
      <h2>里程碑總覽</h2>
      <div class="kpi" id="kpi"></div>
    </section>

    <section class="panel">
      <h2>現金流 & 資產成長趨勢（月）</h2>
      <div style="padding:10px">
        <canvas id="cv" height="420"></canvas>
      </div>
    </section>
  </main>

  <script>
    const $ = s=>document.querySelector(s);
    const fmt = n=>'NT$'+Math.round(n).toLocaleString('zh-TW');
    const monthsToY = m => m===Infinity ? '尚未達成（模擬期內）' : (Math.floor(m/12)+' 年 '+(m%12? m%12+' 個月':''));

    const defaults = {survival:60000, lifestyle:120000, fat:216000, assets:3000000, mainIncome:200000, sideIncome:40000, mainGrowth:3, sideGrowth:10, returnRate:6, wr:4, years:40, reinvest:'yes'};

    function read(){
      return {
        survival:+$('#survival').value||0,
        lifestyle:+$('#lifestyle').value||0,
        fat:+$('#fat').value||0,
        assets0:+$('#assets').value||0,
        main0:+$('#mainIncome').value||0,
        side0:+$('#sideIncome').value||0,
        gMain:(+$('#mainGrowth').value||0)/100,
        gSide:(+$('#sideGrowth').value||0)/100,
        r:(+$('#returnRate').value||0)/100,
        wr:(+$('#wr').value||0)/100,
        years:Math.max(1, Math.min(60, +$('#years').value||40)),
        reinvest: $('#reinvest').value==='yes'
      };
    }

    function simulate(){
      const p = read();
      const months = p.years*12|0;
      const mG = Math.pow(1+p.gMain,1/12)-1;
      const sG = Math.pow(1+p.gSide,1/12)-1;
      const rM = Math.pow(1+p.r,1/12)-1;
      const wrM = p.wr/12;
      const L=[]; const main=[]; const sideOnly=[]; const total=[]; const passive=[]; const assets=[];
      const t = {survival:Infinity, life:Infinity, work:Infinity, fire:Infinity, fat:Infinity};
      let A = p.assets0;
      for(let m=0;m<=months;m++){
        const ma = p.main0*Math.pow(1+mG,m);
        const si = p.side0*Math.pow(1+sG,m);
        const pa = A*wrM;
        const to = ma+si+pa;
        L.push((m/12).toFixed(1)+'y'); main.push(ma); sideOnly.push(si); total.push(to); passive.push(pa); assets.push(A);
        if(t.survival===Infinity && si>=p.survival) t.survival=m;
        if(t.life===Infinity && to>=p.lifestyle) t.life=m;
        if(t.work===Infinity && si>=ma) t.work=m;           // ★ 工作自由：副業 ≥ 主業
        if(t.fire===Infinity && pa>=p.lifestyle) t.fire=m;
        if(t.fat===Infinity && pa>=p.fat) t.fat=m;
        const c = p.reinvest? Math.max(0, to-p.lifestyle):0;
        A = A*(1+rM) + c;
      }
      const fireTarget=p.lifestyle*12/p.wr, fatTarget=p.fat*12/p.wr;
      return {p,L,main,sideOnly,total,passive,assets,t,fireTarget,fatTarget};
    }

    function KPI(S){
      const el = $('#kpi');
      const K = [
        ['生存自由（副業 ≥ 生存）', S.t.survival, [['達成時間', monthsToY(S.t.survival)], ['達成時副業月收', S.t.survival<Infinity? fmt(S.sideOnly[S.t.survival]):'—']]],
        ['生活自由（總收入 ≥ 生活）', S.t.life, [['達成時間', monthsToY(S.t.life)], ['達成時總收入', S.t.life<Infinity? fmt(S.total[S.t.life]):'—']]],
        ['工作自由（副業 ≥ 主業）', S.t.work, [['達成時間', monthsToY(S.t.work)], ['達成時副業', S.t.work<Infinity? fmt(S.sideOnly[S.t.work]):'—'], ['達成時主業', S.t.work<Infinity? fmt(S.main[S.t.work]):'—']]],
        ['財富自由 FIRE（資產 ≥ 生活/提領率）', S.t.fire, [['達成時間', monthsToY(S.t.fire)], ['資產門檻', fmt(S.fireTarget)], ['達成時資產', S.t.fire<Infinity? fmt(S.assets[S.t.fire]):'—']]],
        ['財富豐盛 FAT FIRE（資產 ≥ FAT/提領率）', S.t.fat, [['達成時間', monthsToY(S.t.fat)], ['資產門檻', fmt(S.fatTarget)], ['達成時資產', S.t.fat<Infinity? fmt(S.assets[S.t.fat]):'—']]],
      ];
      el.innerHTML = K.map(([title,t,rows])=>{
        const cls = 'k ' + (t<Infinity? 'ok':'warn');
        const rs = rows.map(([k,v])=>`<p><span style="color:#9ca3af">${k}</span>　${v}</p>`).join('');
        return `<div class="${cls}"><h3>${title}</h3>${rs}</div>`;
      }).join('');
    }

    // ----- Canvas Chart（雙軸；加入副業曲線） -----
    const css = n=>getComputedStyle(document.documentElement).getPropertyValue(n).trim();
    const colors = {main:css('--blue'), side:css('--teal'), orange:css('--orange'), green:css('--green'), assets:css('--asset'),
                    sur:css('--sur'), life:css('--life'), fire:css('--fire'), fat:css('--fat')};

    function draw(S){
      const cv = $('#cv'); const dpr = Math.max(1, window.devicePixelRatio||1);
      const padLeft=86, padRight=120, padTop=22, padBot=38;
      const W = cv.clientWidth, H = cv.clientHeight;
      cv.width = W*dpr; cv.height = H*dpr;
      const ctx = cv.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.clearRect(0,0,W,H);

      const leftSets = [
        {name:'主業', data:S.main, color:colors.main, w:2},
        {name:'副業', data:S.sideOnly, color:colors.side, w:2},
        {name:'總收入（含被動）', data:S.total, color:colors.orange, w:2},
        {name:'被動（提領）', data:S.passive, color:colors.green, w:2},
        {name:'生存支出', data:Array(S.L.length).fill(S.p.survival), color:colors.sur, dash:[6,4], w:1},
        {name:'生活支出', data:Array(S.L.length).fill(S.p.lifestyle), color:colors.life, dash:[6,4], w:1},
      ];
      const rightSets = [
        {name:'資產', data:S.assets, color:colors.assets, dash:[5,4], w:1.5},
        {name:'FIRE 資產門檻', data:Array(S.L.length).fill(S.fireTarget), color:colors.fire, dash:[4,4], w:1.2},
        {name:'FAT FIRE 資產門檻', data:Array(S.L.length).fill(S.fatTarget), color:colors.fat, dash:[4,4], w:1.2}
      ];

      const plot = {x:padLeft, y:padTop, w:W-padLeft-padRight, h:H-padTop-padBot};

      const lMin=0, lMax=Math.max(...leftSets.flatMap(s=>s.data));
      const rMin=0, rMax=Math.max(...rightSets.flatMap(s=>s.data));
      const xPos = i => plot.x + plot.w * (i/(S.L.length-1));
      const yLeft = v => plot.y + plot.h * (1 - (v-lMin)/(lMax-lMin||1));
      const yRight= v => plot.y + plot.h * (1 - (v-rMin)/(rMax-rMin||1));

      // grids
      ctx.strokeStyle='#1f2937'; ctx.lineWidth=1; ctx.font='11px system-ui'; ctx.fillStyle='#9ca3af';
      for(let i=0;i<=5;i++){
        const y = plot.y + plot.h*(1 - i/5);
        ctx.beginPath(); ctx.moveTo(plot.x, y); ctx.lineTo(plot.x+plot.w, y); ctx.stroke();
        const lv = lMin + (lMax-lMin)*i/5;
        const rv = rMin + (rMax-rMin)*i/5;
        ctx.fillText('NT$'+Math.round(lv).toLocaleString('zh-TW'), 6, y+4);
        ctx.fillText('資產 '+('NT$'+Math.round(rv).toLocaleString('zh-TW')), plot.x+plot.w+6, y+4);
      }
      for(let i=0;i<=10;i++){
        const idx = Math.floor((S.L.length-1)*i/10);
        ctx.fillText(S.L[idx], plot.x + plot.w*i/10 - 10, H-12);
      }

      function line(set, yfn){
        ctx.beginPath();
        set.data.forEach((v,i)=>{ const x=xPos(i), y=yfn(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
        ctx.lineWidth=set.w; ctx.setLineDash(set.dash||[]); ctx.strokeStyle=set.color; ctx.stroke(); ctx.setLineDash([]);
      }
      leftSets.forEach(s=>line(s,yLeft));
      rightSets.forEach(s=>line(s,yRight));

      // markers：工作自由、FIRE、FAT
      const marks = [];
      if(S.t.work<Infinity) marks.push({x:xPos(S.t.work), y:yLeft(S.sideOnly[S.t.work]), color:colors.side, label:'工作自由（副≥主）'});
      if(S.t.fire<Infinity) marks.push({x:xPos(S.t.fire), y:yRight(S.assets[S.t.fire]), color:colors.fire, label:'FIRE 達成'});
      if(S.t.fat<Infinity) marks.push({x:xPos(S.t.fat), y:yRight(S.assets[S.t.fat]), color:colors.fat, label:'FAT 達成'});
      marks.forEach(p=>{ ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,4,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#cbd5e1'; ctx.fillText(p.label, p.x+6, p.y-6); });

      // legend
      const legend=[
        ['主業',colors.main],['副業',colors.side],['總收入（含被動）',colors.orange],['被動（提領）',colors.green],
        ['資產',colors.assets],
        ['生存支出',colors.sur],['生活支出',colors.life],
        ['FIRE 資產門檻',colors.fire],['FAT FIRE 資產門檻',colors.fat]
      ];
      let lx=plot.x, ly=plot.y-4; ctx.textBaseline='bottom'; ctx.fillStyle='#cbd5e1';
      legend.forEach(([txt,c])=>{ ctx.fillStyle=c; ctx.fillRect(lx, ly-8, 14, 3); ctx.fillStyle='#cbd5e1'; ctx.fillText(' '+txt, lx+16, ly); lx += ctx.measureText(' '+txt).width + 48; });
    }

    function run(){ const S = simulate(); KPI(S); draw(S); }
    $('#calc').addEventListener('click', run);
    $('#fatfill').addEventListener('click', ()=>{$('#fat').value=Math.round((+$('#lifestyle').value||0)*1.8); run();});
    $('#reset').addEventListener('click', ()=>{ 
      for(const k in defaults){ const el = document.getElementById(k); if(!el) continue; el.value = defaults[k]; } 
      run();
    });
    window.addEventListener('resize', run, {passive:true});
    run();
  </script>

  <footer style="padding:14px 12px;color:#9ca3af;font-size:12px;border-top:1px solid var(--line);text-align:center">
    ⚠️ 本工具僅供教育與規劃參考，非投資建議。所有金額以新台幣計算，採「月」為週期、年化率折算為月複利。｜離線版 v1.3
  </footer>
</body>
</html>
