<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>鷹家財務自由路徑試算｜FIRE Playground</title>
  <meta name="description" content="互動試算：生存自由／生活自由／工作自由／財富自由／FAT FIRE 達成時間與目標資產" />
  <style>
    :root{
      --bg:#0f172a;
      --panel:#111827;
      --ink:#e5e7eb;
      --muted:#9ca3af;
      --accent:#22c55e;
      --danger:#ef4444;
      --purple:#a855f7;
      --gold:#f59e0b;
      --blue:#3b82f6;
      --orange:#fb923c;
      --line:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;line-height:1.5}
    a{color:#93c5fd}
    header{padding:20px 16px;border-bottom:1px solid var(--line);position:sticky;top:0;background:linear-gradient(180deg, rgba(15,23,42,0.98), rgba(15,23,42,0.96));backdrop-filter:saturate(160%) blur(6px);z-index:5}
    header h1{margin:0;font-size:20px;font-weight:700}
    header p{margin:4px 0 0;color:var(--muted);font-size:12px}
    .wrap{display:grid;grid-template-columns:1fr;gap:16px;padding:16px;max-width:1200px;margin:0 auto}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .panel h2{margin:0;padding:12px 16px;border-bottom:1px solid var(--line);font-size:14px;color:#cbd5e1;letter-spacing:0.4px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;padding:12px}
    .row{display:grid;grid-template-columns:1.1fr 1fr;gap:10px;align-items:center}
    label{font-size:12px;color:var(--muted)}
    input[type="number"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2b3443;background:#0b1220;color:var(--ink);outline:none}
    input[type="number"]:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,0.2)}
    .hint{font-size:11px;color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;padding:0 12px 12px}
    button{cursor:pointer;border:1px solid var(--line);background:#0b1220;color:#e5e7eb;padding:10px 14px;border-radius:10px}
    button.primary{background:#0ea5e9;border-color:#0284c7}
    button.ghost{background:transparent}
    .kpi{display:grid;grid-template-columns:repeat(1,1fr);gap:10px;padding:12px}
    .k{border:1px dashed #334155;border-radius:10px;padding:10px}
    .k h3{margin:0 0 8px 0;font-size:13px;letter-spacing:0.4px}
    .k p{margin:2px 0;font-size:12px;color:#cbd5e1}
    .tag{font-size:10px;padding:2px 6px;border-radius:999px;background:#0b1220;border:1px solid #334155;color:#cbd5e1}
    .ok{border-color:#14532d;background:rgba(34,197,94,0.08)}
    .warn{border-color:#7f1d1d;background:rgba(239,68,68,0.06)}
    footer{padding:18px 16px;color:var(--muted);font-size:12px;border-top:1px solid var(--line);text-align:center}
    canvas{max-height:520px}
    @media(min-width:880px){
      .wrap{grid-template-columns:360px 1fr}
      .kpi{grid-template-columns:repeat(3,1fr)}
      .grid .row{grid-template-columns:1.2fr 1fr}
    }
  </style>
</head>
<body>
  <header>
    <h1>鷹家財務自由路徑試算｜FIRE Playground</h1>
    <p>輸入台幣金額與參數，系統將即時試算「生存自由／生活自由／工作自由／FIRE／FAT FIRE」達成時間與資產目標。</p>
  </header>

  <main class="wrap">
    <!-- Controls -->
    <section class="panel" aria-label="輸入參數">
      <h2>輸入參數（單位：NT$ / 月；年化% 以百分比填寫）</h2>
      <div class="grid" id="formGrid">
        <div class="row">
          <label for="survival">生存支出（基本開銷）</label>
          <input type="number" id="survival" min="0" step="1000" value="60000"/>
        </div>
        <div class="row">
          <label for="lifestyle">生活支出（理想生活）</label>
          <input type="number" id="lifestyle" min="0" step="1000" value="120000"/>
        </div>
        <div class="row">
          <label for="fat">FAT FIRE 生活支出（可填倍數，預設 = 生活 × 1.8）</label>
          <input type="number" id="fat" min="0" step="1000" value="216000"/>
        </div>
        <div class="row">
          <label for="assets">目前投資資產淨值</label>
          <input type="number" id="assets" min="0" step="10000" value="3000000"/>
        </div>
        <div class="row">
          <label for="mainIncome">主業收入（月）</label>
          <input type="number" id="mainIncome" min="0" step="1000" value="200000"/>
        </div>
        <div class="row">
          <label for="sideIncome">副業收入（月）</label>
          <input type="number" id="sideIncome" min="0" step="1000" value="40000"/>
        </div>
        <div class="row">
          <label for="mainGrowth">主業年成長率（%）</label>
          <input type="number" id="mainGrowth" step="0.1" value="3"/>
        </div>
        <div class="row">
          <label for="sideGrowth">副業年成長率（%）</label>
          <input type="number" id="sideGrowth" step="0.1" value="10"/>
        </div>
        <div class="row">
          <label for="returnRate">投資年化報酬率（%）</label>
          <input type="number" id="returnRate" step="0.1" value="6"/>
        </div>
        <div class="row">
          <label for="wr">提領率（% / 年，FIRE 常見 4%）</label>
          <input type="number" id="wr" step="0.1" value="4"/>
        </div>
        <div class="row">
          <label for="years">模擬年數（1–60）</label>
          <input type="number" id="years" min="1" max="60" value="40"/>
        </div>
        <div class="row">
          <label for="reinvest">盈餘是否全部投入資產？（總收入－生活支出）</label>
          <select id="reinvest" style="width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2b3443;background:#0b1220;color:var(--ink)">
            <option value="yes" selected>是（預設）</option>
            <option value="no">否（只以每月固定 0 元投入）</option>
          </select>
        </div>
        <p class="hint">說明：每月盈餘＝主業＋副業＋被動收入－生活支出。若選擇「是」，盈餘將自動定期投入，並以月複利滾存。</p>
      </div>
      <div class="actions">
        <button class="primary" id="calcBtn">重新計算</button>
        <button class="ghost" id="fillFat">用「生活 × 1.8」填入 FAT FIRE</button>
        <button class="ghost" id="resetBtn">重設為預設值</button>
      </div>
    </section>

    <!-- KPI -->
    <section class="panel" aria-label="里程碑">
      <h2>里程碑總覽</h2>
      <div class="kpi" id="kpiBoard">
        <!-- Cards will be injected -->
      </div>
    </section>

    <!-- Chart -->
    <section class="panel" aria-label="趨勢圖">
      <h2>現金流 & 資產成長趨勢（月）</h2>
      <div style="padding:12px">
        <canvas id="chart" height="420"></canvas>
      </div>
    </section>
  </main>

  <footer>
    <div>⚠️ 本工具僅供教育與規劃參考，非投資建議。所有金額以新台幣計算，採「月」為週期、年化率折算為月複利。</div>
    <div style="margin-top:6px">設計：鷹式一家 × ChatGPT｜版本 1.0</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script>
    // ----- Helpers -----
    const $ = s => document.querySelector(s);
    const fmtNTD = n => 'NT$' + (Math.round(n)).toLocaleString('zh-TW');
    const monthsToY = m => {
      if(m === Infinity) return '尚未達成（模擬期內）';
      const y = Math.floor(m/12);
      const mm = m % 12;
      if(y===0) return mm + ' 個月';
      return y + ' 年 ' + (mm ? (mm + ' 個月') : '');
    };
    const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

    // Default snapshot for reset
    const defaults = {
      survival: 60000, lifestyle: 120000, fat: 216000,
      assets: 3000000, mainIncome: 200000, sideIncome: 40000,
      mainGrowth: 3, sideGrowth: 10, returnRate: 6, wr: 4, years: 40, reinvest: "yes"
    };

    function readInputs(){
      const survival = +$('#survival').value || 0;
      const lifestyle = +$('#lifestyle').value || 0;
      const fat = +$('#fat').value || Math.round(lifestyle*1.8);
      const assets0 = +$('#assets').value || 0;
      const main0 = +$('#mainIncome').value || 0;
      const side0 = +$('#sideIncome').value || 0;
      const gMain = (+$('#mainGrowth').value || 0)/100;
      const gSide = (+$('#sideGrowth').value || 0)/100;
      const r = (+$('#returnRate').value || 0)/100;
      const wr = (+$('#wr').value || 0)/100;
      const years = clamp( (+$('#years').value || 30), 1, 60 );
      const reinvest = $('#reinvest').value === 'yes';
      return {survival, lifestyle, fat, assets0, main0, side0, gMain, gSide, r, wr, years, reinvest};
    }

    function simulate(){
      const p = readInputs();
      const months = p.years*12|0;
      const mG = Math.pow(1+p.gMain, 1/12)-1;
      const sG = Math.pow(1+p.gSide, 1/12)-1;
      const rM = Math.pow(1+p.r, 1/12)-1;
      const wrM = p.wr/12;
      
      const labels = [];
      const seriesMain=[], seriesSide=[], seriesTotal=[], seriesPassive=[];
      const seriesAssets=[];
      const thresholds = {
        survival: [], lifestyle: [], FIRE: [], FAT: []
      };

      let A = p.assets0;
      let tSurvival = Infinity, tLifeFree = Infinity, tWorkFree = Infinity, tFIRE = Infinity, tFAT = Infinity;

      for(let m=0;m<=months;m++){
        const main = p.main0 * Math.pow(1+mG, m);
        const side = p.side0 * Math.pow(1+sG, m);
        const passive = A * wrM;  // 可支配被動現金流（以提領率估算）
        const total = main + side + passive;

        // 存入資料列
        labels.push((m/12).toFixed(1)+'y');
        seriesMain.push(main);
        seriesSide.push(main+side); // 用顏色對應「主業（藍）」與「主業+副業=工作收入（較接近藍）」？
        seriesTotal.push(total);
        seriesPassive.push(passive);
        seriesAssets.push(A);

        thresholds.survival.push(p.survival);
        thresholds.lifestyle.push(p.lifestyle);
        thresholds.FIRE.push(p.lifestyle);
        thresholds.FAT.push(p.fat);

        // 里程碑時間（第一次達標即鎖定）
        if (tSurvival===Infinity && side >= p.survival) tSurvival = m;
        if (tLifeFree===Infinity && total >= p.lifestyle) tLifeFree = m;
        if (tWorkFree===Infinity && passive >= main) tWorkFree = m;
        if (tFIRE===Infinity && passive >= p.lifestyle) tFIRE = m;
        if (tFAT===Infinity && passive >= p.fat) tFAT = m;

        // 資產成長（月底結算）：A_{t+1} = A_t*(1+rM) + contribution
        const contribution = p.reinvest ? Math.max(0, total - p.lifestyle) : 0;
        A = A*(1+rM) + contribution;
      }

      // FIRE / FAT FIRE 目標資產（理論值）
      const fireTarget = p.lifestyle*12 / p.wr;
      const fatTarget  = p.fat*12 / p.wr;

      return {
        p, labels, seriesMain, seriesSide, seriesTotal, seriesPassive, seriesAssets, thresholds,
        tSurvival, tLifeFree, tWorkFree, tFIRE, tFAT, fireTarget, fatTarget
      };
    }

    // ----- Chart -----
    let chart;
    function drawChart(S){
      const ctx = $('#chart').getContext('2d');
      if(chart){ chart.destroy(); }

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: S.labels,
          datasets: [
            {label:'主業收入', data:S.seriesMain, borderColor:'#3b82f6', backgroundColor:'transparent', borderWidth:2, tension:0.18},
            {label:'總收入（含被動）', data:S.seriesTotal, borderColor:'#fb923c', backgroundColor:'transparent', borderWidth:2, tension:0.18},
            {label:'被動收入（提領）', data:S.seriesPassive, borderColor:'#22c55e', backgroundColor:'transparent', borderWidth:2, tension:0.18},
            {label:'資產淨值', data:S.seriesAssets, borderColor:'#e5e7eb', yAxisID:'y1', backgroundColor:'transparent', borderWidth:1.5, tension:0.18, borderDash:[5,4]},
            // thresholds
            {label:'生存消費', data:S.thresholds.survival, borderColor:'#8b5cf6', borderDash:[6,4], pointRadius:0},
            {label:'生活消費', data:S.thresholds.lifestyle, borderColor:'#a78bfa', borderDash:[6,4], pointRadius:0},
            {label:'FIRE 門檻（=生活）', data:S.thresholds.FIRE, borderColor:'#ef4444', borderDash:[4,4], pointRadius:0},
            {label:'FAT FIRE 門檻', data:S.thresholds.FAT, borderColor:'#f59e0b', borderDash:[4,4], pointRadius:0},
          ]
        },
        options: {
          maintainAspectRatio:false,
          interaction: {mode:'index', intersect:false},
          plugins: {
            legend: {labels:{color:'#cbd5e1'} },
            tooltip: {
              callbacks:{
                label: ctx => {
                  const ds = ctx.dataset.label;
                  const v = ctx.raw;
                  // 資產用 NT$，其他也用 NT$
                  return ds + ': ' + fmtNTD(v);
                }
              }
            }
          },
          scales: {
            y: {
              grid:{color:'#1f2937'},
              ticks:{color:'#9ca3af', callback: v => 'NT$'+Number(v).toLocaleString('zh-TW')}
            },
            y1: {
              position:'right', grid:{drawOnChartArea:false}, ticks:{color:'#9ca3af', callback:v=>'資產 '+('NT$'+Number(v).toLocaleString('zh-TW'))}
            },
            x: {ticks:{color:'#9ca3af'}}
          }
        }
      });
    }

    // ----- KPI Cards -----
    function renderKPI(S){
      const board = $('#kpiBoard');
      const fireTarget = S.fireTarget;
      const fatTarget = S.fatTarget;

      const items = [
        {title:'生存自由（副業 ≥ 生存）', t:S.tSurvival, ok:S.tSurvival<Infinity, extras:[
          ['達成時間', monthsToY(S.tSurvival)],
          ['達成時副業月收', S.tSurvival<Infinity ? fmtNTD(S.seriesSide[S.tSurvival]-S.seriesMain[S.tSurvival]) : '—']
        ]},
        {title:'生活自由（總收入 ≥ 生活）', t:S.tLifeFree, ok:S.tLifeFree<Infinity, extras:[
          ['達成時間', monthsToY(S.tLifeFree)],
          ['達成時總收入', S.tLifeFree<Infinity ? fmtNTD(S.seriesTotal[S.tLifeFree]) : '—']
        ]},
        {title:'工作自由（被動 ≥ 主業）', t:S.tWorkFree, ok:S.tWorkFree<Infinity, extras:[
          ['達成時間', monthsToY(S.tWorkFree)],
          ['達成時被動月收', S.tWorkFree<Infinity ? fmtNTD(S.seriesPassive[S.tWorkFree]) : '—'],
          ['達成時主業月收', S.tWorkFree<Infinity ? fmtNTD(S.seriesMain[S.tWorkFree]) : '—']
        ]},
        {title:'財富自由 FIRE（被動 ≥ 生活）', t:S.tFIRE, ok:S.tFIRE<Infinity, extras:[
          ['達成時間', monthsToY(S.tFIRE)],
          ['理論資產目標', fmtNTD(fireTarget)],
          ['達成時資產', S.tFIRE<Infinity ? fmtNTD(S.seriesAssets[S.tFIRE]) : '—']
        ]},
        {title:'財富豐盛 FAT FIRE', t:S.tFAT, ok:S.tFAT<Infinity, extras:[
          ['達成時間', monthsToY(S.tFAT)],
          ['理論資產目標', fmtNTD(fatTarget)],
          ['達成時資產', S.tFAT<Infinity ? fmtNTD(S.seriesAssets[S.tFAT]) : '—']
        ]},
      ];

      board.innerHTML = items.map(it => {
        const cls = 'k ' + (it.ok ? 'ok':'warn');
        const rows = it.extras.map(e => `<p><span class="tag">${e[0]}</span>　${e[1]}</p>`).join('');
        return `<div class="${cls}"><h3>${it.title}</h3>${rows}</div>`;
      }).join('');
    }

    // ----- Events -----
    function computeAndRender(){
      const S = simulate();
      renderKPI(S);
      drawChart(S);
    }

    $('#calcBtn').addEventListener('click', computeAndRender);
    $('#fillFat').addEventListener('click', () => {
      const life = +$('#lifestyle').value || 0;
      $('#fat').value = Math.round(life*1.8);
      computeAndRender();
    });
    $('#resetBtn').addEventListener('click', () => {
      for(const k in defaults){
        if(k==='reinvest'){
          $('#reinvest').value = defaults[k];
        }else{
          document.getElementById(k==='wr' ? 'wr' : k).value = defaults[k];
        }
      }
      computeAndRender();
    });

    // Auto-init
    computeAndRender();
  </script>
</body>
</html>
