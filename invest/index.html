
<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>鷹家投資工具箱｜投資複利・貸款利息</title>
  <meta name="description" content="鷹家投資工具箱：投資複利計算器、貸款利息試算（信貸/房貸/車貸/保單借款）。支援幣別、通膨、費用、稅金、XIRR/APR、明細表與圖表。" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="./assets/css/styles.css">
  <script type="module" src="./assets/js/app.js"></script>
</head>
<body>
  <header style="position:sticky;top:0;z-index:20;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid #E2E8F0">
    <div class="container" style="display:flex;gap:1rem;align-items:center;padding:1rem 0;">
      <a href="/" style="font-size:1.25rem;font-weight:800">鷹家投資工具箱</a>
      <div style="color:#64748B">｜投資複利・貸款利息</div>
      <a href="/" class="btn btn-primary" style="margin-left:auto">🛒 回到團購首頁</a>
      <div class="row">
        <label class="label">幣別</label>
        <select id="currency" class="input" style="width:auto">
          <option value="TWD" selected>新台幣（NT$）</option>
          <option value="USD">美元（US$）</option>
          <option value="NZD">紐幣（NZ$）</option>
          <option value="JPY">日圓（¥）</option>
          <option value="CNY">人民幣（CN¥）</option>
          <option value="AUD">澳幣（A$）</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container" style="padding:1.5rem 0;">
    <!-- Top tool selector -->
    <div class="card" style="margin-bottom:1rem">
      <div class="row" id="toolTabs" style="display:flex">
        <button class="tab tab-active" data-tool="compound">📈 投資複利計算器</button>
        <button class="tab tab-inactive" data-tool="loan">🧾 貸款利息計算器</button>
      </div>
      <div class="row" id="toolSelectWrap" style="margin-top:.5rem">
        <label class="label">選擇工具</label>
        <select id="toolSelect" class="input" style="max-width:280px">
          <option value="compound" selected>📈 投資複利計算器</option>
          <option value="loan">🧾 貸款利息計算器</option>
        </select>
      </div>
    </div>

    <!-- Compound Tool -->
    <div class="grid grid-cols-12" id="tool-compound">
      <section class="col-span-5 card">
        <div class="row" id="tabs">
          <button data-tab="lump" class="tab tab-active">💰 一次性投入</button>
          <button data-tab="dca" class="tab tab-inactive">📅 每月定期定額</button>
          <button data-tab="stepup" class="tab tab-inactive">📈 定期不定額（步進加碼）</button>
          <button data-tab="irregular" class="tab tab-inactive">🗓️ 不定期/不定額</button>
          <button data-tab="goal" class="tab tab-inactive">🎯 目標反推</button>
        </div>

        <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem; margin-bottom:1rem">
          <div>
            <div class="label">年化報酬率（%）</div>
            <input id="annualReturn" type="number" step="0.01" value="8" class="input" />
          </div>
          <div>
            <div class="label">投資期間（年）</div>
            <input id="years" type="number" step="0.1" value="10" class="input" />
          </div>
          <div>
            <div class="label">複利頻率</div>
            <select id="compoundFreq" class="input">
              <option value="1">每年</option>
              <option value="2">每半年</option>
              <option value="4">每季</option>
              <option value="12" selected>每月</option>
              <option value="365">每日（近似）</option>
            </select>
          </div>
          <div>
            <div class="label">通膨率（%/年，計算實質）</div>
            <input id="inflation" type="number" step="0.01" value="2" class="input" />
          </div>
        </div>

        <details style="margin-bottom:1rem">
          <summary class="label" style="cursor:pointer">進階選項（手續費 / 稅金 / 起始日期）</summary>
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem; margin-top:.75rem">
            <div>
              <div class="label">申購手續費（%/投入）</div>
              <input id="feePct" type="number" step="0.01" value="0" class="input" />
            </div>
            <div>
              <div class="label">贖回手續費（%/資產）</div>
              <input id="redeemPct" type="number" step="0.01" value="0" class="input" />
            </div>
            <div>
              <div class="label">年度管理費（%/年）</div>
              <input id="mgmtPct" type="number" step="0.01" value="0" class="input" />
            </div>
            <div>
              <div class="label">資本利得稅（%/獲利）</div>
              <input id="taxPct" type="number" step="0.01" value="0" class="input" />
            </div>
            <div style="grid-column:1/ -1">
              <div class="label">起始日期（不定期現金流與XIRR使用）</div>
              <input id="startDate" type="date" class="input" />
            </div>
          </div>
        </details>

        <div id="panel-lump">
          <div>
            <div class="label">一次性投入金額</div>
            <input id="lumpAmount" type="number" step="1000" value="300000" class="input" />
          </div>
          <div class="row" style="margin-top:.5rem">
            <button class="btn btn-primary" onclick="runLump()">計算</button>
            <button class="btn btn-ghost" onclick="location.reload()">重置</button>
          </div>
        </div>

        <div id="panel-dca" class="hidden">
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem">
            <div>
              <div class="label">每月投入金額</div>
              <input id="dcaAmount" type="number" step="100" value="10000" class="input" />
            </div>
            <div>
              <div class="label">投入日（每月）</div>
              <input id="dcaDay" type="number" min="1" max="28" value="1" class="input" />
            </div>
          </div>
          <div class="row" style="margin-top:.5rem">
            <button class="btn btn-primary" onclick="runDCA()">計算</button>
            <button class="btn btn-ghost" onclick="location.reload()">重置</button>
          </div>
        </div>

        <div id="panel-stepup" class="hidden">
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem">
            <div>
              <div class="label">初始每月投入</div>
              <input id="stepBase" type="number" step="100" value="8000" class="input" />
            </div>
            <div>
              <div class="label">每年加碼（%）</div>
              <input id="stepPct" type="number" step="0.1" value="5" class="input" />
            </div>
            <div>
              <div class="label">加碼頻率</div>
              <select id="stepFreq" class="input">
                <option value="12" selected>每年一次</option>
                <option value="6">每半年</option>
                <option value="3">每季</option>
              </select>
            </div>
            <div>
              <div class="label">最高每月上限</div>
              <input id="stepCap" type="number" step="100" value="0" class="input" placeholder="0=不設上限" />
            </div>
          </div>
          <div class="row" style="margin-top:.5rem">
            <button class="btn btn-primary" onclick="runStepUp()">計算</button>
            <button class="btn btn-ghost" onclick="location.reload()">重置</button>
          </div>
        </div>

        <div id="panel-irregular" class="hidden">
          <div class="kpi">
            <div style="font-size:.875rem;color:#475569">新增現金流（投入為正、贖回為負）。最末日自動加入「期末資產」現金流以計算 XIRR。</div>
            <div class="row">
              <button class="btn btn-ghost" onclick="addCashflowRow()">＋新增一筆</button>
              <button class="btn btn-ghost" onclick="seedCashflows()">載入範例</button>
              <button class="btn btn-ghost" onclick="clearCashflows()">清空</button>
            </div>
            <div style="overflow:auto;border:1px solid #E2E8F0;border-radius:.75rem">
              <table class="table">
                <thead>
                  <tr>
                    <th style="min-width:130px">日期</th>
                    <th style="min-width:130px">金額（投入+／贖回-）</th>
                    <th>備註</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="cashflowBody"></tbody>
              </table>
            </div>
          </div>
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem">
            <div>
              <div class="label">期末日期（評價點）</div>
              <input id="endDate" type="date" class="input" />
            </div>
            <div>
              <div class="label">期末資產市值</div>
              <input id="endingValue" type="number" step="100" value="0" class="input" />
            </div>
          </div>
          <div class="row" style="margin-top:.5rem">
            <button class="btn btn-primary" onclick="runIrregular()">計算 & XIRR</button>
          </div>
        </div>

        <div id="panel-goal" class="hidden">
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem">
            <div>
              <div class="label">目標金額</div>
              <input id="goalTarget" type="number" step="1000" value="10000000" class="input" />
            </div>
            <div>
              <div class="label">反推項目</div>
              <select id="goalSolveFor" class="input">
                <option value="monthly" selected>所需每月投入</option>
                <option value="years">所需年數</option>
              </select>
            </div>
            <div id="goalMonthlyBox">
              <div class="label">（若解年數）預設每月投入</div>
              <input id="goalMonthly" type="number" step="100" value="10000" class="input" />
            </div>
            <div id="goalYearsBox">
              <div class="label">（若解每月）預設年數</div>
              <input id="goalYears" type="number" step="0.5" value="15" class="input" />
            </div>
          </div>
          <div class="row" style="margin-top:.5rem">
            <button class="btn btn-primary" onclick="runGoal()">開始反推</button>
          </div>
        </div>
      </section>

      <section class="col-span-7 card">
        <div class="grid" style="grid-template-columns:1fr 1fr; gap:1rem">
          <div class="kpi">
            <div class="label">期末資產</div>
            <div id="outFinal" style="font-size:1.5rem;font-weight:800">—</div>
            <div class="label">（實質）<span id="outFinalReal">—</span></div>
          </div>
          <div class="kpi">
            <div class="label">總投入 / 總報酬</div>
            <div class="value"><span id="outTotalIn">—</span> ／ <span id="outGain">—</span></div>
            <div class="label">有效年化（CAGR）：<span id="outCAGR">—</span></div>
          </div>
          <div class="kpi">
            <div class="label">XIRR（不定期）或名義年化</div>
            <div id="outXIRR" class="value">—</div>
            <div class="label">含手續費/管理費/稅金後估算</div>
          </div>
          <div class="kpi">
            <div class="label">期間與期數</div>
            <div class="value"><span id="outYears">—</span> 年 ／ <span id="outPeriods">—</span> 期</div>
            <div class="label">複利頻率：<span id="outFreq">—</span>／年</div>
          </div>
        </div>
        <div style="margin-top:1rem"><canvas id="chart" height="120"></canvas></div>
        <div style="margin-top:1rem">
          <details>
            <summary class="label" style="cursor:pointer">展開查看明細表（期別 / 投入 / 利息 / 手續費 / 稅金 / 結餘）</summary>
            <div style="overflow:auto;border:1px solid #E2E8F0;border-radius:.75rem;margin-top:.75rem">
              <table class="table">
                <thead>
                  <tr>
                    <th>期數</th><th>日期</th><th>投入</th><th>利息</th><th>費用</th><th>稅金</th><th>期末餘額</th>
                  </tr>
                </thead>
                <tbody id="detailBody"></tbody>
              </table>
            </div>
          </details>
        </div>
      </section>
    </div>

    <!-- Loan Tool -->
    <div id="tool-loan" class="hidden">
      <div class="grid grid-cols-12">
        <section class="col-span-5 card">
          <div class="row" style="margin-bottom:.5rem">
            <button class="btn btn-ghost" onclick="applyLoanPreset('personal')">💳 信貸</button>
            <button class="btn btn-ghost" onclick="applyLoanPreset('mortgage')">🏠 房貸</button>
            <button class="btn btn-ghost" onclick="applyLoanPreset('auto')">🚗 車貸</button>
            <button class="btn btn-ghost" onclick="applyLoanPreset('policy')">📜 保單借款</button>
          </div>
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem">
            <div>
              <div class="label">貸款金額</div>
              <input id="loanAmount" type="number" step="1000" value="1000000" class="input" />
            </div>
            <div>
              <div class="label">年利率（%）</div>
              <input id="loanAPR" type="number" step="0.01" value="2" class="input" />
            </div>
            <div>
              <div class="label">期數（年）</div>
              <input id="loanYears" type="number" step="1" value="20" class="input" />
            </div>
            <div>
              <div class="label">每年期數</div>
              <select id="loanPY" class="input"><option value="12" selected>12（每月）</option><option value="6">6（雙月）</option><option value="4">4（季）</option></select>
            </div>
            <div>
              <div class="label">攤還法</div>
              <select id="loanMethod" class="input">
                <option value="annuity" selected>等額本息</option>
                <option value="equal_principal">等額本金</option>
                <option value="interest_only">只付息（到期還本）</option>
                <option value="bullet">先息後本（一次清償）</option>
              </select>
            </div>
            <div>
              <div class="label">起始日期</div>
              <input id="loanStart" type="date" class="input" />
            </div>
          </div>
          <details style="margin-top:.75rem">
            <summary class="label" style="cursor:pointer">進階（手續費/開辦費/違約金）</summary>
            <div class="grid" style="grid-template-columns:1fr 1fr; gap:.75rem; margin-top:.75rem">
              <div>
                <div class="label">開辦費（固定額）</div>
                <input id="loanFeeFixed" type="number" step="100" value="0" class="input" />
              </div>
              <div>
                <div class="label">手續費（%/貸款額）</div>
                <input id="loanFeePct" type="number" step="0.01" value="0" class="input" />
              </div>
            </div>
          </details>
          <div class="row" style="margin-top:.75rem">
            <button class="btn btn-primary" onclick="runLoan()">計算</button>
            <button class="btn btn-ghost" onclick="resetLoan()">重置</button>
          </div>
        </section>

        <section class="col-span-7 card">
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:1rem">
            <div class="kpi"><div class="label">每期應繳</div><div id="loanOutPMT" style="font-size:1.5rem;font-weight:800">—</div><div class="label">（等額本息固定金額；其他依期變動）</div></div>
            <div class="kpi"><div class="label">總利息 / 總成本</div><div class="value"><span id="loanOutInterest">—</span> ／ <span id="loanOutTotalCost">—</span></div></div>
            <div class="kpi"><div class="label">APR（含費用）</div><div id="loanOutAPR" class="value">—</div></div>
            <div class="kpi"><div class="label">期數</div><div class="value"><span id="loanOutN">—</span> 期</div></div>
          </div>
          <div style="margin-top:1rem"><canvas id="loanChart" height="120"></canvas></div>
          <div style="margin-top:1rem">
            <details>
              <summary class="label" style="cursor:pointer">展開查看攤還明細（期數 / 日期 / 本金 / 利息 / 月付 / 剩餘）</summary>
              <div style="overflow:auto;border:1px solid #E2E8F0;border-radius:.75rem;margin-top:.75rem">
                <table class="table">
                  <thead><tr><th>期數</th><th>日期</th><th>本金</th><th>利息</th><th>月付</th><th>剩餘本金</th></tr></thead>
                  <tbody id="loanDetailBody"></tbody>
                </table>
              </div>
            </details>
          </div>
        </section>
      </div>
    </div>

    <footer class="container" style="padding:2rem 0;text-align:center;color:#64748B;font-size:.75rem">※ 本工具為教育用途之試算，實際投資請自行評估風險與稅務規定。／ © 2025</footer>
  </main>

  <script type="module" src="./assets/js/format.js"></script>
  <script type="module" src="./assets/js/ui.js"></script>
  <script type="module" src="./assets/js/chart.js"></script>
  <script type="module" src="./assets/js/compound.js"></script>
  <script type="module" src="./assets/js/loan.js"></script>
  <script type="module" src="./assets/js/app.js"></script>
</body>
</html>
